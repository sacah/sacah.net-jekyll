---
layout: post
title: Facebook Javascript API - Post to wall - FB JS SDK
date: '2012-02-12T10:29:00.002+10:00'
author: sacah
tags:
- javascript
- software
- facebook
- programming
modified_time: '2012-02-12T10:31:04.941+10:00'
thumbnail: http://1.bp.blogspot.com/-8TzdmB0HkpY/TzcGbSmX5fI/AAAAAAABMLM/7lJ_89m9DH8/s72-c/fbwallpost.png
blogger_id: tag:blogger.com,1999:blog-4605009901196846959.post-7304201814648918794
blogger_orig_url: http://www.sacah.net/2012/02/facebook-javascript-api-post-to-wall-fb.html
---

Working with the Facebook JS SDK I was having problems using the FB.ui to log the user is, and post a message to their wall. Main error was '<span class="st"><span class="f"></span><i>Permission denied</i> to <i>access</i> property 'Arbiter'.'. I tried many different things such as developing this on a website that could be accessed from external sources, but the problem wouldn't go away.</span><br /><span class="st"><br /></span><br /><span class="st">So I wrote some code that used FB.login and FB.api, though after login/permission acceptance it would leave the XD Proxy window open on a blank page. Below is my code which will handle the XD Proxy window, login, permission acceptance and post to their wall, even on your local environment without external sources being able to access your site.</span><br /><span class="st"><br /></span><br /><span class="st">First we install the FB API</span><br /><span class="st"><br /></span><br /><pre>&lt;script&gt;<br /> window.fbAsyncInit = function() {<br />   FB.init({<br />     appId      : facebookAppId,<br />     channelUrl : 'http://'+ window.location.host +'/channel.html',<br />     status     : true,<br />     cookie     : true,<br />     xfbml      : true,<br />     oauth      : true<br />   });<br /> };<br /><br /> (function(d){<br />    var js, id = 'facebook-jssdk'; if (d.getElementById(id)) {return;}<br />    js = d.createElement('script'); js.id = id; js.async = true;<br />    js.src = "//connect.facebook.net/en_US/all.js";<br />    d.getElementsByTagName('head')[0].appendChild(js);<br />  }(document));<br />&lt;/script&gt;</pre><span class="st"><br /></span><br /><span class="st">Next we want to setup the function to handle the login/permissions.</span><br /><span class="st"><br /></span><br /><pre>function FBShare(title, link, picture, msg, caption) {<br />   FB.login(function(data) {<br />     postFBMsg(title, link, picture, msg, caption);<br />   }, {scope: 'publish_stream'});<br /> }<br /></pre><span class="st"><br /></span><br /><span class="st">Here I call FB.login, setting scope to <i>publish_stream </i>which once the user is logged in will ask for permission to allow my app to publish to their wall.</span><br /><span class="st">Once login is complete and they have accepted my permissions, we call postFBMsg.</span><br /><span class="st"><br /></span><br /><pre>function postSocialMsg(title, link, picture, msg, caption) {<br />   var body={<br />     message: msg,<br />     picture: picture,<br />     link: 'http://'+ window.location.host +'/'+ link,<br />     name: title,<br />     caption: caption<br />   }<br /><br />   FB.api('/me/feed', 'post', body, function(response) {<br />     if (!response || response.error) {<br />       // Error<br />     } else {<br />       // Successful<br />     }<br />   });<br /> }<br /></pre><span class="st"><br /></span><br /><span class="st">Here I set the <i>body</i> var to contain our Facebook Wall Post details, we have the <i>title</i>(Don't Worry Be Happy) which will be linked to <i>link</i>, we have <i>picture</i>(Guy Sebastian pic), <i>msg</i>(Wall Post Message) which will appear under the Username(John Smith), <i>title</i> and <i>caption</i>(Guy Sebastian) which will appear under our Message to the right of the picture. If no Caption is sent it displays the link URL instead.</span><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://1.bp.blogspot.com/-8TzdmB0HkpY/TzcGbSmX5fI/AAAAAAABMLM/7lJ_89m9DH8/s1600/fbwallpost.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://1.bp.blogspot.com/-8TzdmB0HkpY/TzcGbSmX5fI/AAAAAAABMLM/7lJ_89m9DH8/s1600/fbwallpost.png" /></a></div><span class="st"><br /></span><br /><span class="st">The final piece to our puzzle is to handle the closing of the XD Proxy window after login. It posts back to the calling window after actions are performed, I setup an event to capture these messages and close the window once it receives one. If you already are using postMessage between windows, you'll need to setup a conditional statement to only close the window if it's a Facebook message.</span><br /><span class="st"><br /></span><br /><pre> $(window).bind('message', function(e) {<br />   e.originalEvent.source.window.close();<br /> });<br /></pre><span class="st"><br /></span><br /><span class="st">So once we get a message via postMessage we close the window of the message sender.</span><br /><span class="st"><br /></span><br /><span class="st">This is how I'm doing it in my local development environment, inaccessible to the outside world, if you spot and flaws, or know of a better way of doing things please leave a comment.</span>