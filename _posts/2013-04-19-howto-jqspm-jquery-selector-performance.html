---
layout: post
title: ! 'HowTo: jqspm - jQuery Selector Performance Monitor'
date: '2013-04-19T20:11:00.001+10:00'
author: sacah
tags:
- javascript
- howto
- jquery
- programming
modified_time: '2013-04-20T17:58:18.762+10:00'
thumbnail: http://2.bp.blogspot.com/-W5LZbCjBevs/UXEONZOGNWI/AAAAAAABoYA/WFfFzUn8jlM/s72-c/jqspm-example.jpg
blogger_id: tag:blogger.com,1999:blog-4605009901196846959.post-9091613396278067745
blogger_orig_url: http://www.sacah.net/2013/04/howto-jqspm-jquery-selector-performance.html
---

<h3>Quick Start:</h3>Head over to the <a href="https://bitbucket.org/sacah/jqspm-jquery-selector-perf-monitor/overview">jqspm</a> repo, grab the files and checkout the README.<br /><br />So I'll assume you've grabbed the files and have read the brief README. So here I'll cover how <a href="https://bitbucket.org/sacah/jqspm-jquery-selector-perf-monitor/overview">jqspm (jQuery Selector Performance Monitor)</a> monitors selectors, and how to interpret the results.<br /><br /><h3>How it works</h3>When you call jqspm.start() the script wraps the existing jQuery() and jQuery.find() functions in monitoring functions. These monitoring functions capture what selectors are being passed in, they then call the original jQuery functions and record how long it took for them to execute, and how many elements they returned.<br /><br />Once you have monitored some calls you'll want to printReport, this is where there may be some confusion, so I'll take some time explaining all the points I think might be confusing. Below is a picture of a report printed via console.table.<br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://2.bp.blogspot.com/-W5LZbCjBevs/UXEONZOGNWI/AAAAAAABoYA/WFfFzUn8jlM/s1600/jqspm-example.jpg" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="68" src="http://2.bp.blogspot.com/-W5LZbCjBevs/UXEONZOGNWI/AAAAAAABoYA/WFfFzUn8jlM/s320/jqspm-example.jpg" width="320" /></a></div><br /><br /><br /><b>Selectors column</b><br />Here are the list of selectors that were called during the monitoring. You will notice they are separated by an =&gt;, so the following:<br /><blockquote class="tr_bq">$('UL').find('LI');</blockquote>Will result in a selector looking like:<br /><blockquote class="tr_bq">"UL =&gt; LI"</blockquote>As you can see from the picture above, this will keep going on the longer you chain calls to jQuery() or jQuery.find().<br /><br /><br /><b>totalCount column</b><br />This is the total number of elements that were returned by the whole chain of selectors.<br /><br /><br /><b>Counts column</b><br />This is a list of the number of elements each part of the selector chain returned. So a selector like:<br /><blockquote class="tr_bq">$('UL').find('LI');</blockquote>Will return a count of:<br /><blockquote class="tr_bq">[ 3, 11 ]</blockquote>This tells you it found 3 ULs, and 11 LIs.<br /><br /><b>totalTime column</b> <br />This is the combine time it took to find all elements that were returned by the chain of selectors. This is a good number to look at to pick up inefficient selector chains.<br /><br /><b>Timings column</b><br />This is a list of timings for each selector in the chain, so using the same chain as above:<br /><blockquote class="tr_bq">$('UL').find('LI');</blockquote>Will return:<br /><blockquote class="tr_bq">[ 3, 5 ] </blockquote><br /><h3><b>Oddities</b></h3><b>Single Id selectors:</b><br />Queries like<br /><blockquote class="tr_bq">$('#menuHolder').find('UL');<b><br /></b></blockquote>&nbsp;Will only return counts/timings for the UL selector. I am looking at adding in the ability to monitor single ID selectors, but it's not high on the priority list as that query should only ever return 1 element, and should be instant.<br /><br />The problem this currently posses is counts and timings for the above query will only contain 1 number, even though there are 2 selectors occurring, just keep that in mind when investigating results. <br /><br /><b>Chaining saved selectors:</b><br />Queries like<br /><blockquote class="tr_bq">var $obj=$('BODY');<br />$('UL');<br />$obj.find('UL');</blockquote>Will give you 3 results<br /><blockquote class="tr_bq">"BODY"<br />"UL"<br />"BODY =&gt; UL"</blockquote>The one I want to bring your attention to is the last one, it's counts and timings will look like this<br /><blockquote class="tr_bq">[ "", 3 ]</blockquote>This is because you chained a saved selector, $obj, so you know that BODY was from a previous selector.<br /><br /><h3>What to look for</h3>Here are a few screenshots showing how this can help, this is a real selector example I've found in production code. Though in the production environment there were a ton of other elements within each LI, this was causing the iPhone 5 to take 8.5 seconds to execute. By changing it all into the one selector that time was cut to about 50ms.<br /><br />When you see a large number of elements returned early in the query chain, you should look at ways to optimise. In the IE8 example below, jQuery found 1557 LIs, and each of these was added to an array of elements.<br /><br />It then loops through that array, executing the second selector (UL) on each element, so it executes it 1557 times. Each time it does this it needs to copy the elements it found back to the main collection array, and in browsers with poor memory management, or systems with limited memory, this can be costly.<br /><br />Notice how when we moved the second selector into the first query, eliminating the need to loop, query, add to array, we get much better performance.<br /><br />IE8 <br /><div class="separator" style="clear: both; text-align: center;"><a href="http://3.bp.blogspot.com/-NZwKVZdArt8/UXHsKi9MecI/AAAAAAABoYM/FDICmCcvUck/s1600/jqspm-ie8-example.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="80" src="http://3.bp.blogspot.com/-NZwKVZdArt8/UXHsKi9MecI/AAAAAAABoYM/FDICmCcvUck/s320/jqspm-ie8-example.png" width="320" /></a></div><br /><br /><br /><br /><br />Nexus 4 - Chrome<br /><div class="separator" style="clear: both; text-align: center;"><a href="http://4.bp.blogspot.com/-tfSM53y4ZaM/UXHsRSghQaI/AAAAAAABoYU/YAoqGkwd96c/s1600/jqspm-c-nexus-4-example.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="71" src="http://4.bp.blogspot.com/-tfSM53y4ZaM/UXHsRSghQaI/AAAAAAABoYU/YAoqGkwd96c/s320/jqspm-c-nexus-4-example.png" width="320" /></a></div><br /><br /><br /><h3>Wrap it up</h3><span style="font-weight: normal;">Hop</span>e that has made sense, and you find this useful, let me know any questions you have, or feedback, I'll update this page once I add more features.