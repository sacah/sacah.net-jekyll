---
layout: post
title: Using perceptual diffs to spot mistakes during web development
date: '2013-08-01T18:54:00.003+10:00'
author: sacah
tags:
- testing
- programming
modified_time: '2013-08-01T19:00:17.515+10:00'
thumbnail: http://3.bp.blogspot.com/-FwQATG-ftdw/UfofrUCFs6I/AAAAAAABqwE/uyXeGmeMS9Q/s72-c/pdiff-blog-clipped-example-.png
blogger_id: tag:blogger.com,1999:blog-4605009901196846959.post-4689864131717608263
blogger_orig_url: http://www.sacah.net/2013/08/using-perceptual-diffs-to-spot-mistakes.html
---

So I started this a month ago when I saw a video from <a href="http://www.youtube.com/watch?v=UMnZiTL0tUc">Google about pdiffs</a>, then got promptly distracted on other projects and games...<br /><br />Then today saw a post from <a href="http://responsivenews.co.uk/post/56884056177/wraith">BBC</a> about this sort of thing and figured I'd post with how far I've gotten, and see if it spurs me to do more testing on how best this can be displayed.<br /><br />Basically, you want an easy way to check for style/layout changes. Automating this is difficulttime consuming, and eye balling it can all look the same after a few iterations.<br />So you use perceptual diffs to spot the difference between 2 images, one a control image of your website that's correct. The second image is a current screenshot, and if they differ, you'll have a diff image highlighting the differences.<br /><br />The problem I had with this diff image was it's hard to match the differences when you're looking at a desktop site, having 3 images side by side, each 960px wide, my eyes couldn't pick smaller differences even with the help of the diff image. Say you add a 1px margin to the bottom of a repeating news element, it get's pretty hard to tell that with 3 separate images (Control, Latest change, Diff).<br /><br />So my idea is around slicing the Control and Latest change screenshot into 100px wide columns, then alternating them next to each other. Having this 100px side by side really helps pick out the differences that are highlighted by the diff image.<br /><br />Next I tried using the diff image to darken the sliced images where no differences were. This resulted in a final image like this:<br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://3.bp.blogspot.com/-FwQATG-ftdw/UfofrUCFs6I/AAAAAAABqwE/uyXeGmeMS9Q/s1600/pdiff-blog-clipped-example-.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="236" src="http://3.bp.blogspot.com/-FwQATG-ftdw/UfofrUCFs6I/AAAAAAABqwE/uyXeGmeMS9Q/s640/pdiff-blog-clipped-example-.png" width="640" /></a></div><br />Here you can see the brighter areas are where a difference was detected. So if you look at the image of Obama, in the Control slices you'll notice a white line below, in the Latest change slices you'll notice the white line above. This highlights that the image moved down in the Latest changes from the Control.<br />You'll also notice that when looking at the text.<br /><br />&nbsp;Here is a resized full size you a bit of idea.<br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://4.bp.blogspot.com/-Gk0U6GjEjDE/Ufogd_hB4DI/AAAAAAABqwM/bZCdE1ghGBk/s1600/pdiff-blog-full-example-new.jpg" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="320" src="http://4.bp.blogspot.com/-Gk0U6GjEjDE/Ufogd_hB4DI/AAAAAAABqwM/bZCdE1ghGBk/s320/pdiff-blog-full-example-new.jpg" width="114" /></a></div><br /><br />So to figure out what worked I've just been using ImageMagick. I think the next step might be writing this in something with a bit more custom control to do more highlighting of changes vs the rest of the image. Below is the commands I've been using.<br />news.com.au-before-tweaks.png is the Control<br />news.com.au-after-tweaks.png is the Latest changes<br /><br /><blockquote class="tr_bq"><span style="font-size: x-small;">perceptualdiff -output pdiff.png news.com.au-before-tweaks.png news.com.au-after-tweaks.png</span><br /><span style="font-size: x-small;">..\ImageMagick-6.8.6-0\convert pdiff.png -threshold 0%% pdiff-des.png</span><br /><span style="font-size: x-small;">..\ImageMagick-6.8.6-0\composite -compose CopyOpacity pdiff-des.png news.com.au-before-tweaks.png news.com.au-before-tweaks-alpha.png</span><br /><span style="font-size: x-small;">..\ImageMagick-6.8.6-0\composite -compose CopyOpacity pdiff-des.png news.com.au-after-tweaks.png news.com.au-after-tweaks-alpha.png</span><br /><span style="font-size: x-small;"><br /></span><span style="font-size: x-small;">..\ImageMagick-6.8.6-0\convert news.com.au-before-tweaks.png -level -85%% news.com.au-before-tweaks-bg.png</span><br /><span style="font-size: x-small;">..\ImageMagick-6.8.6-0\convert news.com.au-before-tweaks-bg.png +gravity -crop 100x6280 bg_tiles_%%03d_a.png</span><br /><span style="font-size: x-small;">..\ImageMagick-6.8.6-0\convert bg_tiles_*_a.png -matte -bordercolor none -border 1x0 bg_tiles_%%03d_a.png</span><br /><span style="font-size: x-small;">..\ImageMagick-6.8.6-0\convert news.com.au-before-tweaks-bg.png +gravity -crop 100x6280 bg_tiles_%%03d_b.png</span><br /><span style="font-size: x-small;">..\ImageMagick-6.8.6-0\convert bg_tiles_*_b.png -matte -bordercolor none -border 1x0 bg_tiles_%%03d_b.png</span><br /><span style="font-size: x-small;">..\ImageMagick-6.8.6-0\convert bg_tiles_*.png +append news.com.au-before-tweaks-bg.png</span><br /><span style="font-size: x-small;"><br /></span><span style="font-size: x-small;">..\ImageMagick-6.8.6-0\convert news.com.au-before-tweaks-alpha.png +gravity -crop 100x6280 tiles_%%03d_a.png</span><br /><span style="font-size: x-small;">..\ImageMagick-6.8.6-0\convert tiles_*_a.png -matte -bordercolor none -border 1x0 tiles_%%03d_a.png</span><br /><span style="font-size: x-small;">..\ImageMagick-6.8.6-0\convert news.com.au-after-tweaks-alpha.png +gravity -crop 100x6280 tiles_%%03d_b.png</span><br /><span style="font-size: x-small;">..\ImageMagick-6.8.6-0\convert tiles_*_b.png -matte -bordercolor none -border 1x0 tiles_%%03d_b.png</span><br /><span style="font-size: x-small;">..\ImageMagick-6.8.6-0\convert tiles_*.png +append tiled_news.png</span><br /><span style="font-size: x-small;"><br /></span><span style="font-size: x-small;">..\ImageMagick-6.8.6-0\composite tiled_news.png news.com.au-before-tweaks-bg.png news.com.au-final.png</span><br /><span style="font-size: x-small;">del tile*.png</span><br /><span style="font-size: x-small;">del bg_tile*.png</span></blockquote><br />Let me know if you go further with this and get a better result, or even a different approach that works for you. 