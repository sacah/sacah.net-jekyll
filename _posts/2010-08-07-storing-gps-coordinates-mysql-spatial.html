---
layout: post
title: Storing GPS Coordinates - MySQL, Spatial, Flat Files
date: '2010-08-07T19:00:00.003+10:00'
author: sacah
tags:
- project
- benchmark
modified_time: '2010-08-07T19:04:03.965+10:00'
thumbnail: http://1.bp.blogspot.com/_-gckRFXob4c/TF0c2HMBlJI/AAAAAAAAAP0/25kvUf1Ewwo/s72-c/latlonTable.png
blogger_id: tag:blogger.com,1999:blog-4605009901196846959.post-8323161334809622748
blogger_orig_url: http://www.sacah.net/2010/08/storing-gps-coordinates-mysql-spatial.html
---

I'm working on a new project that will require storing peoples location, and allowing others to browse a map and see those peoples locations. In order to test which would be the best solution I wrote a PHP script to generate random clusters of GPS coordinates and store them in the tables.<br /><br />The two tables I used were MySQL tables, one with an id(int), lat(decimal) and lon(decimal) columns and the second with an id(int) and coords(Point) columns. The script would save the same generated point in both tables so I could be assured the same data was in both. After generating 118 million coordinates the spatial table was double the file size of the decimal lat/lon table.<br /><br />Next I cleared the data and created indexes on the tables, the first one had an index on lat and lon, the second had an index on coords.<br /><br />Due to the speed issues on the Spatial index I only ran the GPS generator on one table at a time, first on the lon/lat table, it generated 604,734,087 records, weighing in at 25.3Gb(45bytes per record). Starting at 30,000 inserts per second, then as more records were inserted speed decreased as you can see in the graph below, though you can see only 3 times did it dip below 5000 inserts per second. Y axis contains the number of records, X axis is the number of inserts per second.<br /><br /><div style="text-align: center;"><a href="http://1.bp.blogspot.com/_-gckRFXob4c/TF0c2HMBlJI/AAAAAAAAAP0/25kvUf1Ewwo/s1600/latlonTable.png" imageanchor="1"><img border="0" height="217" src="http://1.bp.blogspot.com/_-gckRFXob4c/TF0c2HMBlJI/AAAAAAAAAP0/25kvUf1Ewwo/s400/latlonTable.png" width="400" /></a></div><br />Next I ran the generator on the spatial table, it generated 17,160,836 records, weighing 1.6Gb(100bytes per record). This table started at 26,000 inserts per second, and quickly dipped to 39 inserts per second at the lowest point.<br /><div style="text-align: center;"><a href="http://2.bp.blogspot.com/_-gckRFXob4c/TF0eh4EvNAI/AAAAAAAAAP8/z8N1gJ1UVk0/s1600/spatialTable.jpg" imageanchor="1"><img border="0" height="168" src="http://2.bp.blogspot.com/_-gckRFXob4c/TF0eh4EvNAI/AAAAAAAAAP8/z8N1gJ1UVk0/s400/spatialTable.jpg" width="400" /></a></div><br />I was a bit surprised at the difference, though figuring the Spatial one would do much better in queries that the insert speed and filesize didn't bother me too much. I ran the following query on each table.<br />SELECT id FROM latlon WHERE (lon&gt;7.1 &amp;&amp; lon&lt;8.1) &amp;&amp; (lat&gt;12.2 &amp;&amp; lat&lt;13.2)<br />SELECT id FROM spatial WHERE (X(coords)&gt;7.1 &amp;&amp; X(coords)&lt;8.1) &amp;&amp; (Y(coords)&gt;12.2 &amp;&amp; Y(coords)&lt;13.2)<br /><br />latlon query took 1.35 seconds, spatial query took 44.2 seconds, and remember the spatial table only has 17 million records compared to the 600 million in the latlon table. Very surprising results, I under stand the cool things you can do with selecting points that intersect a line, or are contained within a shape etc with the spatial tables, but given that our users will always be browsing via a rectangle map, a simple query like above will do fine.<br /><br />If anyone has any ideas about things I might have done wrong with my spatial setup to result in it being drastically slower please let me know. <br /><br />Next I thought I'd try flat files. I'll post more over the coming days about my tests with them.