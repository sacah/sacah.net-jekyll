---
layout: post
title: Linux Batch Thumbnail Creation of folder with subdirectories
date: '2014-04-13T12:36:00.000+10:00'
author: sacah
tags:
- bash
- programming
- photos
- raspberry pi
modified_time: '2014-04-13T12:41:13.928+10:00'
blogger_id: tag:blogger.com,1999:blog-4605009901196846959.post-592268148388679244
blogger_orig_url: http://www.sacah.net/2014/04/linux-batch-thumbnail-creation-of.html
---

I have a RaspberryPi with a 750gb attached HDD, on this drive I store a folder called Photos, it contains many sub-directories with photos in them.<br /><br />I wanted to create a new directory that had the same structure of Photos, but all the images are smaller thumbnailed versions.<br /><br />To accomplish this I tried a number of programs and scripts I found online for linux, but most didn't handle sub-directories, I then tried to find programs on Windows that would do this across the network, but they either didn't handle sub-directories or didn't handle errors in network traffic and would bomb out.<br /><br />So I wrote my own Bash script<br /><br /><pre>#!/bin/bash<br /><br />find $1 -type f -iname '*.jpg' -print0 | while IFS= read -r -d '' file; do<br />  newFile="${file/$1/$1Thumbs}"<br />  if [ ! -f "$newFile" ]<br />  then<br />    echo "$newFile"<br />    mkdir -p "$(dirname "$newFile")"<br />    convert -sample 1024x1024 "$file" "$newFile"<br />  fi<br />done<br /></pre><br />I called this batch-photos.sh, so if I want to create thumbnails of /mnt/sda1/Photos I run<br /><br />./batch-photos.sh /mnt/sda1/Photos<br /><br />It will then create a folder /mnt/sda1/PhotosThumbs and do all the sub-directory creation and save the thumbnails there.<br /><br />For now it resizes to a max width/height of 1024, maintaining the photos aspect. It also uses 'sample' method of ImageMagicks convert, as this is the fastest and still gave a good result when making photos smaller.<br /><br />It will also skip over thumbnails that already exist, it does a simple check if that filename, in the matching sub-directory exists. <br /><br />Here are the various convert methods I used to get a speedy result<br /><br /><table><thead><tr><th>convert -size 1024x1024 -sample 1024x1024 -quality 80</th></tr></thead><tbody><tr><td>mnt/sda1/PhotosThumbs/DSC00412.JPG</td><td>6799ms</td></tr><tr><td>mnt/sda1/PhotosThumbs/100702/100_6722.JPG</td><td>2391ms</td></tr><tr><td>mnt/sda1/PhotosThumbs/100702/100_6687.JPG</td><td>2676ms</td></tr><tr><td>mnt/sda1/PhotosThumbs/100702/100_6671.JPG</td><td>2492ms</td></tr><tr><td>mnt/sda1/PhotosThumbs/100702/100_6683.JPG</td><td>2669ms</td></tr><tr><td>mnt/sda1/PhotosThumbs/100702/F1000004.JPG</td><td>1502ms</td></tr><tr><td>mnt/sda1/PhotosThumbs/100702/100_6686.JPG</td><td>4278ms</td></tr><tr><td>mnt/sda1/PhotosThumbs/100702/100_6704.JPG</td><td>2408ms</td></tr><tr><td>mnt/sda1/PhotosThumbs/100702/F1000013.JPG</td><td>1562ms</td></tr></tbody></table><br /><table><thead><tr><th>convert -size 1024x1024 -sample 1024x1024</th></tr></thead><tbody><tr><td>mnt/sda1/PhotosThumbs/DSC00412.JPG</td><td>6598ms</td></tr><tr><td>mnt/sda1/PhotosThumbs/100702/100_6722.JPG</td><td>2382ms</td></tr><tr><td>mnt/sda1/PhotosThumbs/100702/100_6687.JPG</td><td>2711ms</td></tr><tr><td>mnt/sda1/PhotosThumbs/100702/100_6671.JPG</td><td>2571ms</td></tr><tr><td>mnt/sda1/PhotosThumbs/100702/100_6683.JPG</td><td>3920ms</td></tr><tr><td>mnt/sda1/PhotosThumbs/100702/F1000004.JPG</td><td>1507ms</td></tr><tr><td>mnt/sda1/PhotosThumbs/100702/100_6686.JPG</td><td>2843ms</td></tr><tr><td>mnt/sda1/PhotosThumbs/100702/100_6704.JPG</td><td>2442ms</td></tr><tr><td>mnt/sda1/PhotosThumbs/100702/F1000013.JPG</td><td>1570ms</td></tr></tbody></table><br /><table><thead><tr><th>convert -sample 1024x1024</th></tr></thead><tbody><tr><td>mnt/sda1/PhotosThumbs/DSC00412.JPG</td><td>6515ms</td></tr><tr><td>mnt/sda1/PhotosThumbs/100702/100_6722.JPG</td><td>2376ms</td></tr><tr><td>mnt/sda1/PhotosThumbs/100702/100_6687.JPG</td><td>3561ms</td></tr><tr><td>mnt/sda1/PhotosThumbs/100702/100_6671.JPG</td><td>3042ms</td></tr><tr><td>mnt/sda1/PhotosThumbs/100702/100_6683.JPG</td><td>2694ms</td></tr><tr><td>mnt/sda1/PhotosThumbs/100702/F1000004.JPG</td><td>1514ms</td></tr><tr><td>mnt/sda1/PhotosThumbs/100702/100_6686.JPG</td><td>2867ms</td></tr><tr><td>mnt/sda1/PhotosThumbs/100702/100_6704.JPG</td><td>2428ms</td></tr><tr><td>mnt/sda1/PhotosThumbs/100702/F1000013.JPG</td><td>1560ms </td></tr></tbody></table><br /><table><thead><tr><th>convert -size 1024x1024 -resize 1024x1024</th></tr></thead><tbody><tr><td>mnt/sda1/PhotosThumbs/DSC00412.JPG</td><td>34815ms</td></tr><tr><td>mnt/sda1/PhotosThumbs/100702/100_6722.JPG</td><td>8996ms</td></tr><tr><td>mnt/sda1/PhotosThumbs/100702/100_6687.JPG</td><td>9305ms</td></tr><tr><td>mnt/sda1/PhotosThumbs/100702/100_6671.JPG</td><td>10490ms</td></tr><tr><td>mnt/sda1/PhotosThumbs/100702/100_6683.JPG</td><td>9287ms</td></tr><tr><td>mnt/sda1/PhotosThumbs/100702/F1000004.JPG</td><td>5494ms</td></tr><tr><td>mnt/sda1/PhotosThumbs/100702/100_6686.JPG</td><td>11137ms</td></tr><tr><td>mnt/sda1/PhotosThumbs/100702/100_6704.JPG</td><td>9061ms</td></tr><tr><td>mnt/sda1/PhotosThumbs/100702/F1000013.JPG</td><td>5596ms</td></tr></tbody></table><br /><table><thead><tr><th>convert -resize 1024x1024</th></tr></thead><tbody><tr><td>mnt/sda1/PhotosThumbs/DSC00412.JPG</td><td>33566ms</td></tr><tr><td>mnt/sda1/PhotosThumbs/100702/100_6722.JPG</td><td>10510ms</td></tr><tr><td>mnt/sda1/PhotosThumbs/100702/100_6687.JPG</td><td>9336ms</td></tr><tr><td>mnt/sda1/PhotosThumbs/100702/100_6671.JPG</td><td>9072ms</td></tr><tr><td>mnt/sda1/PhotosThumbs/100702/100_6683.JPG</td><td>10677ms</td></tr><tr><td>mnt/sda1/PhotosThumbs/100702/F1000004.JPG</td><td>5540ms</td></tr><tr><td>mnt/sda1/PhotosThumbs/100702/100_6686.JPG</td><td>9707ms</td></tr><tr><td>mnt/sda1/PhotosThumbs/100702/100_6704.JPG</td><td>10465ms</td></tr><tr><td>mnt/sda1/PhotosThumbs/100702/F1000013.JPG</td><td>5561ms</td></tr></tbody></table><br /><br /><style type="text/css">TABLE TH { width: 400px; } TABLE TD { padding-bottom: 4px; border-bottom: solid #AAA 1px; } </style>